-- Remove all existing RLS policies for study_materials to avoid conflicts
DROP POLICY IF EXISTS "Users can view their own study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Users can update their own study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Users can delete their own study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Users can create their own study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Admins can manage study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Users can view basic study material info" ON public.study_materials;
DROP POLICY IF EXISTS "Anyone can view study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Only admins can create study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Only admins can update study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Only admins can delete study materials" ON public.study_materials;
DROP POLICY IF EXISTS "Users can view their own or admin materials" ON public.study_materials;

-- Create consolidated RLS policies for study_materials
CREATE POLICY "Users can manage their own study materials"
ON public.study_materials
FOR ALL
USING (auth.uid() = uploaded_by)
WITH CHECK (auth.uid() = uploaded_by);

CREATE POLICY "Admins have full access to study materials"
ON public.study_materials
FOR ALL
USING (public.has_role(auth.uid(), 'admin'::app_role))
WITH CHECK (public.has_role(auth.uid(), 'admin'::app_role));

-- Anyone can view materials
CREATE POLICY "Anyone can view study materials"
ON public.study_materials
FOR SELECT
USING (true);
